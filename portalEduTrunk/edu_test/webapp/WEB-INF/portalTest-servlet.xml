<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xmlns:aop="http://www.springframework.org/schema/aop"
	xsi:schemaLocation=" http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd http://www.springframework.org/schema/aop http://www.springframework.org/schema/aop/spring-aop.xsd">
	
	<bean id="velocityConfig"
		class="org.springframework.web.servlet.view.velocity.VelocityConfigurer">
		
		<property name="resourceLoaderPath">
			<value>/WEB-INF/velocity/</value>
		</property>
		
		<property name="velocityProperties">
			<props>
				<prop key="input.encoding">UTF-8</prop>
				<prop key="output.encoding">UTF-8</prop>
			</props>
		</property>
	</bean>
	
	<bean id="localeResolver"
		class="org.springframework.web.servlet.i18n.CookieLocaleResolver"/>
	
	<bean id="localeChangeInterceptor"
		class="org.springframework.web.servlet.i18n.LocaleChangeInterceptor"/>
	
	<bean id="messageSource"
		class="org.springframework.context.support.ResourceBundleMessageSource">
		
		<property name="basename" value="messages"/>
	</bean>
	
	<bean id="servletContextFactory"
		class="org.springframework.web.context.support.ServletContextFactoryBean"/>
	
	<bean id="portalDescription"
		class="lv.webkursi.mtest.core.data.FileModelFactory">
		<property name="baseDir">
			<value>WEB-INF/data</value>
		</property>
		<property name="fileName">
			<value>portalDescription.n3</value>
		</property>
		<property name="servletContext">
			<ref bean="servletContextFactory"/>
		</property>
	</bean>
	
	<bean id="loginController"
		class="lv.webkursi.mtest.core.mvc.LoginController">
		<property name="serviceFactory">
			<ref bean="serviceFactory"/>
		</property>
	</bean>
	
	<bean id="fixedController"
		class="lv.webkursi.mtest.core.mvc.FixedController">
		<property name="serviceFactory">
			<ref bean="serviceFactory"/>
		</property>
	</bean>
	
	<bean id="componentManager"
		class="lv.webkursi.mtest.core.components.factories.MVComponentManager"
		scope="request">
		<aop:scoped-proxy/>
		<property name="factoryCatalog">
			<map>
				<entry key="http://www.hpl.hp.com/schema/mars#RootComponent">
					<bean
						class="lv.webkursi.mtest.core.components.factories.RootComponentFactory">
						<property name="serviceFactory" ref="serviceFactory"/>
					</bean>
				</entry>
				<entry key="http://www.hpl.hp.com/schema/mars#SimpleComponent">
					<bean
						class="lv.webkursi.mtest.core.components.factories.SimpleComponentFactory"/>
				</entry>
				<entry key="http://www.hpl.hp.com/schema/mars#ResultPane">
					<bean
						class="lv.webkursi.mtest.core.components.factories.ResultPaneFactory">
						<property name="serviceFactory" ref="serviceFactory"/>
					</bean>
				</entry>
				<entry key="http://www.hpl.hp.com/schema/mars#CompositeFacet">
					<bean
						class="lv.webkursi.mtest.core.components.factories.CompositeFacetFactory">
						<property name="serviceFactory" ref="serviceFactory"/>
					</bean>
				</entry>
				<entry key="http://www.hpl.hp.com/schema/mars#TopComponent">
					<bean
						class="lv.webkursi.mtest.core.components.factories.TopComponentFactory">
						<property name="serviceFactory" ref="serviceFactory"/>
					</bean>
				</entry>
				<entry key="http://www.hpl.hp.com/schema/mars#TextFacet">
					<bean
						class="lv.webkursi.mtest.core.components.factories.TextFacetFactory"/>
				</entry>
				<entry key="http://www.hpl.hp.com/schema/mars#IncDecFacet">
					<bean
						class="lv.webkursi.mtest.core.components.factories.IncDecFacetFactory"/>
				</entry>
				<entry key="http://www.hpl.hp.com/schema/mars#MessageFacet">
					<bean
						class="lv.webkursi.mtest.core.components.factories.TextFacetFactory"/>
				</entry>
				<entry key="http://www.hpl.hp.com/schema/mars#TypeStringMapper">
					<bean
						class="lv.webkursi.mtest.core.mapping.TypeStringMapperFactory"/>
				</entry>
				<entry key="http://www.hpl.hp.com/schema/mars#Rule">
					<bean
						class="lv.webkursi.mtest.core.mvc.rule.RuleFactory">
						<property name="serviceFactory" ref="serviceFactory"/>
					</bean>
				</entry>
			</map>
		</property>
	</bean>
	
	<bean id="urlMapping"
		class="org.springframework.web.servlet.handler.SimpleUrlHandlerMapping">
		<property name="interceptors">
			<list>
				<ref bean="localeChangeInterceptor"/>
			</list>
		</property>
		<property name="mappings">
			<props>
				<prop key="/fixed.do">fixedController</prop>
				<prop key="/login.do">loginController</prop>
			</props>
		</property>
	</bean>
	
	<bean id="serviceFactory"
		class="lv.webkursi.mtest.core.mvc.ServiceFactory">
	</bean>
	
	<bean id="userService" class="lv.webkursi.mtest.core.data.UserService">
	</bean>
	
	<bean id="userSettings"
		class="lv.webkursi.mtest.core.scopes.UserSettings" scope="session">
		<aop:scoped-proxy/>
	</bean>
	
	<bean id="requestHolder"
		class="lv.webkursi.mtest.core.scopes.RequestHolder" scope="request">
		<aop:scoped-proxy/>
	</bean>
	
	<bean id="viewResolver"
		class="org.springframework.web.servlet.view.velocity.VelocityViewResolver">
		<property name="viewClass">
			<value>
				org.springframework.web.servlet.view.velocity.VelocityView</value>
		</property>
		<property name="suffix">
			<value>.vm</value>
		</property>
		<property name="exposeSpringMacroHelpers">
			<value>true</value>
		</property>
		<property name="toolboxConfigLocation" value="/WEB-INF/toolbox.xml"/>
		<property name="contentType">
			<value>text/html;charset=UTF-8</value>
		</property>
	</bean>
</beans>